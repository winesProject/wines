<!doctype html>
<html lang="ko">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!--  tailwind cd  -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!--  tailwind script  -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.0/flowbite.min.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.0/flowbite.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.0/datepicker.min.js"></script>
    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <!--  css  -->
    <link rel="stylesheet" type="text/css" th:href="@{/style.css}">
<!--  csrf 토큰  -->
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Wine's</title>
</head>
<body class="bg-gray-100">
<nav th:replace="~{navbar :: navbarFragment}"></nav>
<th:block layout:fragment="content"></th:block>
<div th:replace="~{sidebar :: sidebarFragment}"></div>
<!--스피드 다이얼-->
<div data-dial-init class="fixed end-6 bottom-6 group">
    <div id="speed-dial-menu-hover" class="flex flex-col items-center hidden mb-4 space-y-2">
        <a sec:authorize="isAuthenticated()" th:href="@{/member/favorites}">
            <button type="button" data-tooltip-target="tooltip-download" data-tooltip-placement="left"
                    class="flex justify-center items-center w-[52px] h-[52px] text-gray-500 hover:text-gray-900 bg-white rounded-full
                border border-gray-200 dark:border-gray-600 shadow-sm dark:hover:text-black dark:text-gray-400 hover:bg-gray-50 dark:bg-gray-700
                dark:hover:bg-gray-600 focus:ring-4 focus:ring-red-800 focus:outline-none dark:focus:ring-gray-400">
                <svg class="w-7 h-7" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"
                     fill="currentColor">
                    <path d="M248 8C111.1 8 0 119.1 0 256s111.1 248 248 248 248-111.1 248-248S384.9 8 248 8zm114.6 226.4l-113 152.7-112.7-152.7c-8.7-11.9-19.1-50.4
                13.6-72 28.1-18.1 54.6-4.2 68.5 11.9 15.9 17.9 46.6 16.9 61.7 0 13.9-16.1 40.4-30 68.1-11.9 32.9 21.6 22.6 60 13.8 72z"/>
                </svg>
                <span class="sr-only">메인 하단 버튼</span>
            </button>
            <div id="tooltip-download" role="tooltip"
                 class="absolute z-10 invisible inline-block w-auto px-3 py-2 text-base font-medium text-black transition-opacity duration-300 bg-gray-200 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700">
                찜
                <div class="tooltip-arrow" data-popper-arrow></div>
            </div>
        </a>
        <a sec:authorize="isAuthenticated()" th:href="@{/review/answer}">
            <button type="button" data-tooltip-target="tooltip-hi" data-tooltip-placement="left"
                    class="flex justify-center items-center w-[52px] h-[52px] text-gray-500 hover:text-gray-900 bg-white rounded-full
                border border-gray-200 dark:border-gray-600 dark:hover:text-white shadow-sm dark:text-gray-400 hover:bg-gray-50 dark:bg-gray-700
                dark:hover:bg-gray-600 focus:ring-4 focus:ring-red-800 focus:outline-none dark:focus:ring-red-400">
                <svg class="w-7 h-7" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 16">
                    <path d="M19 0H1a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1ZM2 6v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6H2Zm11 3a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V8a1 1 0 0 1 2 0h2a1 1 0 0 1 2 0v1Z"/>
                </svg>
                <span class="sr-only">나의 리뷰</span>
            </button>
            <div id="tooltip-hi" role="tooltip"
                 class="absolute z-10 invisible inline-block w-auto px-3 py-2 text-base font-medium text-black transition-opacity duration-300 bg-gray-200 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700">
                나의 리뷰
                <div class="tooltip-arrow" data-popper-arrow></div>
            </div>
        </a>
        <a th:href="@{/question/list}">
            <button type="button" data-tooltip-target="tooltip-copy" data-tooltip-placement="left"
                    class="flex justify-center items-center w-[52px] h-[52px] text-gray-500 hover:text-gray-900 bg-white rounded-full
                border border-gray-200 dark:border-gray-600 dark:hover:text-white shadow-sm dark:text-gray-400 hover:bg-gray-50 dark:bg-gray-700
                dark:hover:bg-gray-600 focus:ring-4 focus:ring-red-800 focus:outline-none dark:focus:ring-red-400">
                <svg class="w-7 h-7" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"
                     fill="currentColor">
                    <path d="M16.1 260.2c-22.6 12.9-20.5 47.3 3.6 57.3L160 376V479.3c0 18.1 14.6 32.7 32.7 32.7c9.7 0 18.9-4.3 25.1-11.8l62-74.3 123.9 51.6c18.9 7.9 40.8-4.5 43.9-24.7l64-416c1.9-12.1-3.4-24.3-13.5-31.2s-23.3-7.5-34-1.4l-448 256zm52.1 25.5L409.7 90.6 190.1 336l1.2 1L68.2 285.7zM403.3 425.4L236.7 355.9 450.8 116.6 403.3 425.4z"/>
                </svg>
                <span class="sr-only">문의하기</span>
            </button>
            <div id="tooltip-copy" role="tooltip"
                 class="absolute z-10 invisible inline-block w-auto px-3 py-2 text-base font-medium text-black transition-opacity duration-300 bg-gray-200 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700">
                문의하기
                <div class="tooltip-arrow" data-popper-arrow></div>
            </div>
        </a>
    </div>
    <button type="button" data-dial-toggle="speed-dial-menu-hover" data-dial-trigger="hover"
            aria-controls="speed-dial-menu-hover" aria-expanded="false"
            class="flex items-center justify-center bg-gray-100 rounded-full w-14 h-14 hover:bg-gray-200 dark:bg-blue-600
            dark:hover:bg-blue-700 focus:ring-4 focus:ring-red-800 focus:outline-none dark:focus:ring-blue-800">
        <svg class="w-11 h-11 transition-transform group-hover:rotate-45" aria-hidden="true"
             xmlns="http://www.w3.org/2000/svg" height="16" width="10" viewBox="0 0 320 512">
            <path d="M64 0C47.4 0 33.5 12.8 32.1 29.3l-14 168.4c-6 72 42.5 135.2 109.9 150.6V448H80c-17.7 0-32
             14.3-32 32s14.3 32 32 32h80 80c17.7 0 32-14.3 32-32s-14.3-32-32-32H192V348.4c67.4-15.4 115.9-78.6 109.9-150.6l-14-168.4C286.5
             12.8 272.6 0 256 0H64zM81.9 203.1L93.4 64H226.6l11.6 139.1C242 248.8 205.9 288 160 288s-82-39.2-78.1-84.9z"/>
        </svg>
        <span class="sr-only">Open actions menu</span>
    </button>
</div>
<footer th:replace="~{footer :: footerFragment}"></footer>
</body>
<!--이메일 인증 및 비밀번호 찾기-->
<script>
    const header = $("meta[name='_csrf_header']").attr('content');
    const token = $("meta[name='_csrf']").attr('content');

    $('#checkEmail').on('click', function(){
        checkEmail();
    });

    function checkEmail(){
        const memberEmail = $('#memberEmail').val();

        if(!memberEmail || memberEmail.trim() === ""){
            alert("이메일을 입력하세요.");
        } else {
            $.ajax({
                type: 'GET',
                url: '/member/checkEmail',
                data: {
                    'memberEmail': memberEmail
                },
                dataType: "text",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader(header, token);
                }
            }).done(function(result){
                console.log("result :" + result);
                if (result == "true") {
                    sendEmail();
                    alert('임시비밀번호를 전송 했습니다.');
                    window.location.href="/auth/login";
                } else if (result == "false") {
                    alert('가입되지 않은 이메일입니다.');
                }
            }).fail(function(error){
                alert(JSON.stringify(error));
            })
        }
    }

    function sendEmail(){
        const memberEmail = $('#memberEmail').val();

        $.ajax({
            type: 'POST',
            url: '/member/sendPwd',
            data: {
                'memberEmail' : memberEmail
            },
            beforeSend: function(xhr){
                xhr.setRequestHeader(header, token);
            },
            error: function(error){
                alert(JSON.stringify(error));
            }
        })
    }
</script>
<!--이메일 인증 및 비밀번호 찾기 끝-->
<!--별점 클릭 후 유지-->
<script th:inline="javascript">

    document.addEventListener('DOMContentLoaded', function () {
        var dateInput = document.querySelector('[datepicker]');
        flatpickr(dateInput, {
            dateFormat: 'm/d/Y',
        });
    });

    $(document).ready(function () {
        // 페이지 로드 시 저장된 클릭 상태를 가져와 설정
        $('[name^="score-"]').each(function () {
            var tasteId = $(this).attr('id');
            var savedValue = localStorage.getItem('selectedValue-' + tasteId);

            if (savedValue === $(this).val()) {
                $(this).prop('checked', true);
            }
        });

        // 각각의 맛 구성 요소에 대한 독립적인 클릭 및 클릭 상태 유지
        $('[name^="score-"]').on('change', function () {
            // 클릭한 라디오 버튼이 이미 체크된 경우, 다시 체크하지 않도록 함
            if (!$(this).prop('checked')) {
                $(this).prop('checked', true);
            }

            var tasteId = $(this).attr('id');
            var selectedValue = $(this).val();

            // 클릭한 값 저장
            localStorage.setItem('selectedValue-' + tasteId, selectedValue);
        });
    });
</script>
<!--별점 클릭 후 유지 끝-->
<!-- 사이드바 스크립트 -->
<script type='text/javascript'>
    function findList() {
        console.log('버튼이 클릭되었습니다!');
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");

        // 서버로 전송할 데이터 설정
        var data = {
            "list": "",
            "country": "",
            "price": ""
        };

        // 와인 종류
        if ($("#red").is(":checked")) {
            data.list += "레드 ";
        }
        if ($("#white").is(":checked")) {
            data.list += "화이트 ";
        }
        if ($("#rose").is(":checked")) {
            data.list += "로제 ";
        }
        if ($("#sparkling").is(":checked")) {
            data.list += "스파클링 ";
        }
        if ($("#fortified").is(":checked")) {
            data.list += "주정강화 ";
        }

        // 나라
        if ($("#france").is(":checked")) {
            data.country += "프랑스 ";
        }
        if ($("#italy").is(":checked")) {
            data.country += "이탈리아 ";
        }
        if ($("#spain").is(":checked")) {
            data.country += "스페인 ";
        }
        if ($("#portugal").is(":checked")) {
            data.country += "포르투갈 ";
        }
        if ($("#germany").is(":checked")) {
            data.country += "독일 ";
        }
        if ($("#usa").is(":checked")) {
            data.country += "미국 ";
        }
        if ($("#new-zealand").is(":checked")) {
            data.country += "뉴질랜드 ";
        }
        if ($("#australia").is(":checked")) {
            data.country += "호주 ";
        }
        if ($("#chile").is(":checked")) {
            data.country += "칠레 ";
        }
        if ($("#argentina").is(":checked")) {
            data.country += "아르헨티나 ";
        }

        var winePrice = parseInt(data.price, 10);

        function checkPriceRange(start, end, value) {
            return !isNaN(value) && value >= start && value <= end;
        }

// 가격
        if ($("#0").is(":checked") || checkPriceRange(0, 20000, winePrice)) {
            data.price += "0~20000 ";
        }
        if ($("#20000").is(":checked") || checkPriceRange(20001, 30000, winePrice)) {
            data.price += "20001~30000 ";
        }
        if ($("#30000").is(":checked") || checkPriceRange(30001, 40000, winePrice)) {
            data.price += "30001~40000 ";
        }
        if ($("#40000").is(":checked") || checkPriceRange(40001, 50000, winePrice)) {
            data.price += "40001~50000 ";
        }
        if ($("#50000").is(":checked") || checkPriceRange(50001, 60000, winePrice)) {
            data.price += "50001~60000 ";
        }
        if ($("#60000").is(":checked") || checkPriceRange(60001, 70000, winePrice)) {
            data.price += "60001~70000 ";
        }
        if ($("#70000").is(":checked") || checkPriceRange(70001, 80000, winePrice)) {
            data.price += "70001~80000 ";
        }
        if ($("#80000").is(":checked") || checkPriceRange(80001, 90000, winePrice)) {
            data.price += "80001~90000 ";
        }
        if ($("#90000").is(":checked") || checkPriceRange(90001, 100000, winePrice)) {
            data.price += "90001~100000 ";
        }
        if ($("#100000").is(":checked") || (winePrice >= 100001)) {
            data.price += "100001~ ";
        }

        // 마지막에 공백 제거
        data.list = data.list.trim();
        data.country = data.country.trim();
        data.price = data.price.trim();

        $.ajax({
            type: 'GET',
            url: "/article/list",
            beforeSend: function (xhr) {
                xhr.setRequestHeader(header, token);
            },
            data: data,
            success: function (response) {
                // 성공 시 리다이렉트 수행
                var redirectUrl = "/article/list";

                if (data.list || data.country || data.price) {
                    redirectUrl += "?";
                }

                if (data.list) {
                    redirectUrl += "list=" + encodeURIComponent(data.list);
                }

                if (data.country) {
                    if (data.list) {
                        redirectUrl += "&";
                    }
                    redirectUrl += "country=" + encodeURIComponent(data.country);
                }

                if (data.price) {
                    if (data.list || data.country) {
                        redirectUrl += "&";
                    }
                    redirectUrl += "price=" + encodeURIComponent(data.price);
                }

                window.location.href = redirectUrl;
            },
            error: function (xhr, status, error) {
                console.log('오류 발생:' + error);
            }
        });
    }
</script>
<!-- 사이드바 스크립트 끝 -->
</html>